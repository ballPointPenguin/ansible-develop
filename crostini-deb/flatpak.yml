---
- name: Setup Flatpak and Install Apps
  hosts: localhost
  become: True
  become_user: root
  tasks:
    - name: add backports repo
      apt_repository:
        repo: deb http://deb.debian.org/debian stretch-backports main contrib non-free
        state: present

    - name: install flatpak
      apt:
        default_release: stretch-backports
        name: flatpak
        state: latest
        update_cache: yes

    # Have to do this manually until ansible 2.8 fixes arrive
    - name: add flathub remote
      command: flatpak remote-add --if-not-exists \
        flathub https://flathub.org/repo/flathub.flatpakrepo

    - name: install Flatpak Apps
      flatpak:
        name: "{{ item }}"
        method: user
      loop:
        - com.discordapp.Discord
        - com.getpostman.Postman
        - com.slack.Slack
        - com.visualstudio.code
        - org.filezillaproject.Filezilla
        - org.gimp.GIMP
        - org.libreoffice.LibreOffice

    - name: update flatpak applications
      command: flatpak update -y
